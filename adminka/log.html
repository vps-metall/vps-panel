<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css" type="text/css">
    <title>Добавление логов</title>
    <link rel="shortcut icon" href="#">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/imask"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="../functions.js"></script>
</head>
<body> 
    <div class="div-white-bg">
        <h2>Добавление нового работника</h2>
        <div class="div-container-add-menu">
            <div class="div-description">
                <h5>Тут можно поставить какое-то уведомление связанно с добавлением нового человека</h5>
            </div>
            <div class="container-form">
                <h5>Системное имя человека</h5>
                <input id="inputNameWorker" type="text">
                <h5>Начало рабочего дня</h5>
                <input id="inputStartDay" type="number">
                <h5>Конец рабочего дня</h5>
                <input id="inputEndDay" type="number">
                
                <p id="pErrorWorker" style="margin-bottom: 12px !important;" class="p-error display-none">Заполните все поля</p>
                <button onclick="addLog()">Добавить</button>
            </div>
        </div>
    </div>
    <div class="div-white-bg">
        <h2>Получить время</h2>
        <div class="div-container-add-menu">
            <div class="div-description">
                <h5>Тут можно поставить какое-то уведомление связанно с добавлением нового человека</h5>
            </div>
            <div class="container-form">
                <input type="date" id="dateInput">
                <input type="time" id="timeInput">
                <button  onclick="getUkraineTimestamp()">Получить timestamp</button>
                <h3 style="margin-top: 24px;" id="h3Time"></h3>
            </div>
        </div>
    </div>


<script>
    

    function addLog(){
        const systemNameWorker = document.querySelector(`#inputNameWorker`).value;
        const timeStartDay = document.querySelector(`#inputStartDay`).value;
        const timeEndDay = document.querySelector(`#inputEndDay`).value;
        const pError = document.querySelector(`#pErrorWorker`);

        if(systemNameWorker.length > 0 && timeStartDay.length > 0 && timeEndDay.length > 0){
            pError.classList.add(`display-none`);
            const objLog = {
                endWorkDay: parseInt(timeEndDay),
                startWorkDay: parseInt(timeStartDay),
                typeLog:"Конец рабочего дня"
            };

            writeToFirebase(`logs/workers/${systemNameWorker}/logs/${timeEndDay}`, objLog);

            document.querySelector(`#inputStartDay`).value = '';
            document.querySelector(`#inputEndDay`).value = '';
        } else {
            pError.classList.remove(`display-none`);
        }
    }

    function getUkraineTimestamp() {
        const dateValue = document.getElementById('dateInput').value; // формат: '2025-04-22'
        const timeValue = document.getElementById('timeInput').value; // формат: '06:30'

        if (!dateValue || !timeValue) {
            console.log("Выберите дату и время");
            return;
        }

        // Объединяем дату и время
        const localDateTimeString = `${dateValue}T${timeValue}:00`;

        // Создаем объект даты как будто это украинское время
        const ukraineDate = new Date(localDateTimeString);

        // Смещение UTC в минутах (для Украины обычно +180 или +120)
        const offsetInMinutes = -ukraineDate.getTimezoneOffset(); // для текущего локального времени

        // Принудительно применим смещение для Украины
        const ukraineOffset = 3 * 60; // UTC+3 в апреле
        const timeDiff = (ukraineOffset - offsetInMinutes) * 60 * 1000;

        const timestamp = ukraineDate.getTime() - timeDiff;

        document.querySelector(`#h3Time`).textContent = timestamp;
        const timeStartDay = document.querySelector(`#inputStartDay`);
        const timeEndDay = document.querySelector(`#inputEndDay`);
        if(timeStartDay.value.length < 1){
            timeStartDay.value = timestamp;
        } else {
            timeEndDay.value = timestamp;
        }
    }

    function transliterate(str) {
    const map = {
        'а': 'a', 'б': 'b', 'в': 'v', 'г': 'g', 'д': 'd', 'е': 'e', 'ё': 'e', 'ж': 'zh', 'з': 'z',
        'и': 'i', 'й': 'y', 'к': 'k', 'л': 'l', 'м': 'm', 'н': 'n', 'о': 'o', 'п': 'p', 'р': 'r',
        'с': 's', 'т': 't', 'у': 'u', 'ф': 'f', 'х': 'kh', 'ц': 'ts', 'ч': 'ch', 'ш': 'sh',
        'щ': 'shch', 'ъ': '', 'ы': 'y', 'ь': '', 'э': 'e', 'ю': 'yu', 'я': 'ya'
    };

    return str
        .toLowerCase() // Делаем все буквы маленькими
        .split('') // Разбиваем строку на массив символов
        .map(char => (char in map) ? map[char] : (char.match(/[a-z0-9\s-]/) ? char : '')) // Транслитерация, удаление лишнего
        .join('') // Собираем обратно в строку
        .replace(/\s+/g, '-') // Заменяем пробелы на тире
        .replace(/-+/g, '-') // Убираем лишние подряд идущие тире
        .replace(/^-|-$/g, ''); // Убираем тире в начале и конце строки
}


</script>
</body> 
</html>
   